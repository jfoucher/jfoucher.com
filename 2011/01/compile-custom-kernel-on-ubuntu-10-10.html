<!DOCTYPE html> 

<html lang="en">

<!-- 
	Access keys:
		H = homepage
		S = search input field
		L = latest article on the homepage
		A = about page
-->
<head>
    <title>
        Compile custom kernel on Ubuntu 10.10
        
    </title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta http-equiv="content-language" content="en" />
	<meta name="author" content="Jonathan Foucher" />
	<meta name="designer" content="Jonathan Fouch" />
	<meta name="developer" content="Jonathan Foucher" />
	<meta name="description" content="My experience compiling a custom kernel from source, using Ubuntu 10.10 Maverick Meerkat, on a Sony Vaio F111 series" />
	<meta name="keywords" content="" />
	<meta name="robots" content="noydir, noopd" /> <!-- Opt out of ODP -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<link rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/en/" />
	<!--<link rel="stylesheet/less" href="/assets/css/screen.less" type="text/css" media="screen" />-->
    <link rel="stylesheet" href="/assets/css/screen.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/assets/css/print.css" type="text/css" media="print" />

    
	<link rel="alternate" href="http://feeds.feedburner.com/GeekyNuggets" title="Geeky Nuggets" type="application/atom+xml" />
	
	<link rel="shortcut icon" type="image/png" href="/favicon.png" />
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <!--<script src="/assets/js/less-1.1.4.js" type="text/javascript"></script>-->
    <script src="/assets/js/jquery.timeago.js" type="text/javascript"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8465441-2']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +
        '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    </script>
</head>

<body>
	<div id="container" class="clearfix">
		                <div id="header" class="center">
            <div class="article-logo">
                <h1>
				    <a href="/" title="Return to homepage" tabindex="0" accesskey="H">
				        <span class="hoverline">Geeky Nuggets</span>
				    </a>
                </h1>
            </div>
            <div class="hero">
                <p class="moin">
                    
                    You&#8217;re currently viewing a single article. Feel free to skip back to
                    <a href="/" rel="home" title="Go back to the homepage" tabindex="0">&sect; Index</a> or straight to
                    <a href="/#notebook" title="Skip straight to the latest article" tabindex="0" accesskey="L">&sect; Latest article</a>.
                </p>
                <p>
                    My experience compiling a custom kernel from source, using Ubuntu 10.10 Maverick Meerkat, on a Sony Vaio F111 series
                </p>
			</div>
		</div> <!-- /#header.center -->
		        <div id="nav" class="clear">
            <ul class="nav nav-header caps">
				<li><a href="/about.html#notebook" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the blog archives" tabindex="0">Archives</a></li>
				<li><a href="/projects/#notebook" title="Go to the code portfolio of Jonathan Foucher" tabindex="0">Projects</a></li>
				<li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Feed link" tabindex="0">Feed</a></li>
            </ul>
			<div class="sitesearch floatRight">
                <div class="sitesearch">
                    <!-- Google Custom Search Element -->
                    <form action="http://www.google.com/cse" class="center_column" id="searchForm" >
                        <fieldset>
                           <input type="hidden" name="cx" value="004905032692135561336:flcwnz7i1ww" />
                           <input type="hidden" name="ie" value="UTF-8" />
                           <label for="search" class="hidden">Search</label>
                           <input id="search" class="text-input" type="text" name="q" size="15" tabindex="0" accesskey="S" />
                           <input id="searchsubmit" type="submit" name="sa" value="Search" tabindex="0" />
                        </fieldset>
                    </form>
                </div>
            </div>
			<div class="clear"></div>
        </div> <!-- /#nav.clear -->

		<div id="notebook" class="center clear">
			<div class="page-nav-top">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2010/05/version-autotag-plugin-released.html#notebook" title="View New version of the auto-tag plugin released!">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/01/python-skype-notifier-for-ubuntu.html#notebook" title="View Python skype notifier for Ubuntu">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-top -->

            <h2 class="clear">Compile custom kernel on Ubuntu 10.10</h2>
            <span class="date" title="2011-01-12T15:06:02+01:00">
                <span class="published">Published&thinsp;&bull;</span>
                <span class="day">12</span>
                <span class="month"><abbr>Jan</abbr></span>
                <span class="year">2011</span>
            </span>
            <div id="entry-content">
                <p>First off, you want to grab the latest kernel source from <a href="http://kernel.org/">http://kernel.org/</a> and save it to a folder on your computer. I used my browser's default :</p>

<div class="highlight"><pre><code class="bash">~/Downloads
</code></pre>
</div>


<p>. Right click on the archive and select "extract here"</p>

<h3>Configuration</h3>


<p>Open a terminal, "cd" to your source directory, in my case</p>

<div class="highlight"><pre><code class="bash"><span class="nb">cd</span> ~/Downloads/linux-2.6.37
</code></pre>
</div>


<p> and run</p>

<div class="highlight"><pre><code class="bash">make gconfig
</code></pre>
</div>


<p> if using Ubuntu or</p>

<div class="highlight"><pre><code class="bash">make kconfig
</code></pre>
</div>


<p> if running Kubuntu. At that point, you'll need to know a fair bit about your system's hardware, to select only the options that are applicable. I like to reuse my current config as a starting point, so if you are using the default ubuntu kernel, the configuration used is stored in the</p>

<div class="highlight"><pre><code class="php"><span class="x">/boot</span>
</code></pre>
</div>


<p> directory, with names like</p>

<div class="highlight"><pre><code class="php"><span class="x">config-2.6.35-24-generic</span>
</code></pre>
</div>


<p> Copy the latest one to your linux source directory. When the configuration editor is loaded, choose</p>

<div class="highlight"><pre><code class="php"><span class="x">File &gt;&gt; Load</span>
</code></pre>
</div>


<p> and select the file you just copied over. Now the Ubuntu default configuration is loaded. If you were to compile your kernel you would get the same kind of system you have now : functional but suboptimal.</p>

<p>We'll try and better that a bit.</p>

<p>The first submenu I open is Processor type and features. In there, I disable everything related to SMP and Paravirtualized guest support as I do not plan to run this as a VM guest. I choose the type of processor appropriate to my machine, in this case "new Xeon"</p>

<p>You can use</p>

<div class="highlight"><pre><code class="bash">make localmodconfig
</code></pre>
</div>


<p> which will disable all the modules not currently loaded from your config file. Be careful though, because if there are devices and/of file systems you're not using at the moment, the drivers won't be added.</p>

<h3>Compiling and instalation</h3>


<p>Once you're happy with the configuration, save and close the editor, and run</p>

<div class="highlight"><pre><code class="bash">make all
</code></pre>
</div>


<p> or</p>

<div class="highlight"><pre><code class="bash">make -j4 all
</code></pre>
</div>


<p> on multicore processors to run several processes in parallel, which will compile the kernel and the modules specified in the .config file</p>

<p>That's the regular debian method, in which you have to run mkinitrd afterwards. I ended up doing it <a href="https://help.ubuntu.com/community/Kernel/Compile">the ubuntu way</a>, where you create .deb packages you can later install with your preferred package manager.</p>

<blockquote>
<p class="line862">If you re-used the existing configuration, note that Ubuntu kernels build with debugging information on, which makes the resulting kernel modules (*.ko files) much larger than they would otherwise be. To turn this off, go into the config's "Kernel hacking"&lt;!-- ; then, under "Kernel debugging", --&gt; and turn OFF "Compile the kernel with debug info".</p>
<p class="line874">Now you can compile the kernel and create the packages:</p>

<div class="highlight"><pre><code class="bash">make-kpkg clean <span class="c"># only needed if you want to do a &quot;clean&quot; build</span>
fakeroot make-kpkg --initrd --append-to-version<span class="o">=</span>-some-string-here kernel-image kernel-headers
</code></pre>
</div>

</blockquote>


<p style="text-align: center;"><img class="aligncenter" src="http://media.tumblr.com/tumblr_let0e9SCP01qzbvjd.png" alt="" width="500" height="338" /></p>


<p>Much easier...</p>

<h3>Drivers</h3>


<p>Of course, if you're using non-free drivers, you'll want to reinstall them. The first time I booted the new kernel, X did not start because it couldn't load the nvidia kernel module. Luckily, I had the latest driver around from a previous install, so installed straight away from the command line.</p>

<p>You should now have a working Ubuntu install running your own custom kernel. Of course, you are responsible for upgradin kernel and binary drivers, as the updates from Ubuntu are not going to work any longer... Although I'm not so sure about that. I'll see in a while I guess.</p>

<h3>Done!</h3>


<p>Anyway, in my case this upgrade is really worth it because I get a functioning built-in microphone on my Vaio! Yay!</p>

<p>So the moral is: don't be scared of trying a custom kernel, it really got much easier, and if you don't like it, going back is as easy as selecting another entry in grub...</p>

                <div class="meta">
                    <!-- <span class="pdf">Download a <a href="/2011/01/compile-custom-kernel-on-ubuntu-10-10.html.pdf" title="Download a PDF, printer-friendly copy of this article"><acronym title="Portable Document Format">PDF</acronym>, printer-friendly version of this article</a>.</span> -->
                    <span class="permalink">For referencing: <a href="/2011/01/compile-custom-kernel-on-ubuntu-10-10.html" title="[Permalink] Compile custom kernel on Ubuntu 10.10">permalink to this article</a>.</span>
                </div> <!-- /.meta -->
            </div> <!-- /.entry-content.colEight -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'geekynuggets'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

            <div class="page-nav-bottom">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2010/05/version-autotag-plugin-released.html#notebook" title="View New version of the auto-tag plugin released!">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/01/python-skype-notifier-for-ubuntu.html#notebook" title="View Python skype notifier for Ubuntu">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-bottom -->
        </div> <!-- /#notebook.center.clear -->
                <div id="footer" class="clear">
			<ul class="nav nav-footer caps">
				<li><a href="/about.html" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the blog archives" tabindex="0">Blog</a></li>
				<li><a href="/projects/#notebook" title="Go to the code portfolio of Jonathan Foucher" tabindex="0">Projects</a></li>
				<li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Feed link" tabindex="0">Feed</a></li>
			</ul>
			<span class="backtop floatRight"><a class="internal" href="#header" title="Return to the top of this page">Back to top &uarr;</a></span>
			<div class="page-meta clear">
				<div class="info">
					
					<p class="copyright ">
                        This blog has been online in one form or another since
                        <span class="date" title="March 2004">2004</span>&thinsp;&mdash;&thinsp;copyright &copy; Jonathan
                        Foucher.&thinsp;&mdash;&thinsp;<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"
                           title="You can use this for non-comercial purposes, provided you cite me as the author, and do not modify the content">
                            Creative Commons License
                        </a>.
                    </p>
				</div>

			</div> <!-- /.page-meta.clear -->
		</div> <!-- /#footer.center.clear -->
	</div>
</body>
</html>
