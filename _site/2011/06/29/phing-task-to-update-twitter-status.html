<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="description" content="A blog about web development, codeigniter and wordpress, by web developer Jonathan Foucher" />
<title>A Phing task to update your Twitter status</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css"  href="/assets/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/assets/css/pygments.css" />
<link rel="icon" href="/favicon.png" type="image/png" /> 
<script type="text/javascript" src="/assets/js/less-1.1.3.min.js"></script>
<meta name="viewport"
  content="width=device-width,
  minimum-scale=1.0, maximum-scale=1.0" />
</head>

<body>
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">

			<div id="access" role="navigation">
				<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
                <div class="menu-header">
    <ul id="menu-new" class="menu">
        <li class="menu-item">
            <a href="http://jfoucher.com">Blog</a>
        </li>
        <li class="menu-item">
            <a title="view my page on about.me" href="http://about.me/jfoucher">About
me</a>
        </li>
        <li class="menu-item">
            <a title="latest works" href="http://jfoucher.fr/">Portfolio</a>
        </li>
        <li class="menu-item"><a title="feedly inspired theme" href="http://jfoucher.com/wp-feedly">WP Feedly</a>
        </li>
    </ul>
</div>

			</div><!-- #access -->
			<div id="branding" role="banner">
				
                <div id="site-title">
                  
					<span>
						<a href="/" title="Geeky Nuggets" rel="home">Geeky Nuggets</a>
					</span>
				
                </div>
                  

				<div id="site-description">Jonathan Foucher's blog <span class="amp">&amp;</span> web development notebook</div>
			</div><!-- #branding -->

		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">


<div id="content">
<h3>Phing and Twitter</h3>


<p>I recently starting working with <a title="PHP build and deployment tool" href="http://www.phing.info">phing</a> to automate the build and deployement process for the web apps I'm building. I use it to compile my LESS files to CSS and minimize then, to compress and concatenate the javascript files, to optimize images using <a href="http://www.smushit.com/">smushit</a>, etc...</p>

<p>I like to be able to comunicate exactly what I'm doing, and thankfully Phing has a built in task to email a message to a list of recipients, which is good, but slightly old school. I wanted something that would be able to integrate readily with twitter, i.e. update my status when a build was completed. I saw <a href="http://codeinthehole.com/archives/14-Phing-task-to-update-Twitter-status.html">this post</a>, which unfortunately uses Basic Auth. As you doubtless know, <a href="http://dev.twitter.com/pages/basic_auth_shutdown">Twitter deprecated this form of authentication</a>, and now asks all users to authenticate using <a href="http://dev.twitter.com/pages/basic_to_oauth">OAuth</a>.</p>

<h3>Download twitterOAuth library</h3>


<p>That meant I had to roll my own phing task... However, thanks to great work by cleverer people, doing it was quite simple. Using <a href="http://abrah.am/">Abraham Williams'</a> <a href="https://github.com/abraham/twitteroauth">twitteroauth</a> library means that the coding I'd have to do was greatly reduced. Awesome, because <a href="http://www.codinghorror.com/blog/2005/08/how-to-be-lazy-dumb-and-successful.html">I aim to be lazy</a>.</p>

<p>The first step is to <a href="https://github.com/abraham/twitteroauth/tarball/master">download the twitteroauth library</a> from github. Extract it to a temporary folder and copy the subfolder <code lang="bash" inline="true">twitteroauth</code> to the folder where your fing tasks are stored (on my system it is <code lang="bash" inline="true">/usr/share/php/phing/tasks/my/</code>. Please note you might have to create the <code lang="bash" inline="true">my/</code> folder within <code lang="bash" inline="true">/usr/share/php/phing/tasks/</code>. You will need root privileges for these steps.</p>

<h3>Register application with Twitter</h3>


<p>Secondly, you need to <a href="https://dev.twitter.com/apps/new">register an application with twitter</a>, as you will need a consumer key and consumer secret later on. Please <a href="https://dev.twitter.com/apps/new">do so now</a>, and come back once you have your app data available.</p>

<h3>Create the custom phing task</h3>


<p>Next up is creating the actual task PHP class. Create an empty file named TwitterUpdateTask.php <code lang="bash">sudo touch /usr/share/php/phing/tasks/my/TwitterUpdateTask.php</code> and open it for editing with your favorite editor. We'll use gedit : <code lang="bash">gksu gedit /usr/share/php/phing/tasks/my/TwitterUpdateTask.php</code></p>

<p>The code for this file is as shown below:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="p">(</span><span class="s2">&quot;phing/Task.php&quot;</span><span class="p">);</span>
<span class="k">require_once</span> <span class="p">(</span><span class="s2">&quot;phing/tasks/my/twitteroauth/twitteroauth.php&quot;</span><span class="p">);</span>


<span class="cm">/* get the lines below from http://twittertokens.6px.eu/ */</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CONSUMER_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Consumer Key Here&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CONSUMER_SECRET&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Consumer Secret Here&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OAUTH_TOKEN&#39;</span><span class="p">,</span> <span class="s1">&#39;Your OAuth Token Here&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OAUTH_TOKEN_SECRET&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Oauth Token Secret Here&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">TwitterUpdateTask</span> <span class="k">extends</span> <span class="nx">Task</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nv">$message</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * The setter for the status message</span>
<span class="cm">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMessage</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">=</span><span class="nv">$str</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">public</span> <span class="k">function</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="cm">/* Connect to twitter */</span>
        <span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TwitterOAuth</span><span class="p">(</span><span class="nx">CONSUMER_KEY</span><span class="p">,</span> <span class="nx">CONSUMER_SECRET</span><span class="p">,</span> <span class="nx">OAUTH_TOKEN</span><span class="p">,</span> <span class="nx">OAUTH_TOKEN_SECRET</span><span class="p">);</span>
        <span class="cm">/* Pass the status message as a parameter */</span>
        <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">);</span>
        <span class="cm">/* Post the data to the API endpoint */</span>
        <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;statuses/update&#39;</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">)){</span>
            <span class="cm">/* if there is an error, fail the build */</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">BuildException</span><span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="cm">/* if there is no error, show a success message */</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="p">(</span><span class="s2">&quot;Status posted to twitter&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>




<h3>Get the OAuth token and secret</h3>


<p>Don't close this file, we still need to add the authentication data to it. You can already place your consumer key and consumer secret in the apropriate <code lang="php" inline="true">define()</code> calls (the first two lines), but if not, we'll do it now.</p>

<p>Navigate to <a href="http://twittertokens.6px.eu">http://twittertokens.6px.eu</a>, put your consumer data and consumer secret in the apropriate fields and click on "Sign in with Twitter". A twitter page will open asking for your confirmation. Click "Sign in" and you are redirected to http://twittertokens.6px.eu/. You should see 4 lines of code appear, that look like this:</p>

<div class="highlight"><pre><code class="php"><span class="x">define(&#39;CONSUMER_KEY&#39;, &#39;V1UsnZJrgfhgKJFoqsQ&#39;);</span>
<span class="x">define(&#39;CONSUMER_SECRET&#39;, &#39;UUazcBfXrWW1jcpiSU564hg654t1EMki8gzptQU&#39;);</span>
<span class="x">define(&#39;OAUTH_TOKEN&#39;, &#39;325454656-EuCudghg8tTYwKf9yjt5nhqr14i5egHJPeVRGVxQv&#39;);</span>
<span class="x">define(&#39;OAUTH_TOKEN_SECRET&#39;, &#39;gh6854hg6tyGEvGEiEi15XmUtOmDpaONM&#39;);</span>
</code></pre>
</div>


<p>Copy this code to the corresponding spot in the TwitterUpdateTask.php file, overwriting what's already there.</p>

<p>Please note though that I'm not making any claims as to how secure this is or whatever. I don't store any of your data anywhere, but if sending your application consumer token and secret worries you, find another way to get the Oauth tokens.</p>

<h3>Create the build file</h3>


<p>First, we define the custom task:</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;taskdef</span> <span class="na">name=</span><span class="s">&quot;twitterupdate&quot;</span> <span class="na">classname=</span><span class="s">&quot;phing.tasks.my.TwitterUpdateTask&quot;</span> <span class="nt">/&gt;</span>
</code></pre>
</div>


<p>Secondly, let's create a custom target that will send a tweet with the message we want.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;tweet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;twitterupdate</span> <span class="na">message=</span><span class="s">&quot;${twitter.status}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/target&gt;</span>
</code></pre>
</div>


<p>Now we can call this task from another one, but we need to make that the twitter.status is set. Let's we have a "staging" target. Part of it could look like this:</p>

<div class="highlight"><pre><code class="xml">    <span class="c">&lt;!-- Set the timestamp to be used in the twitter update --&gt;</span>
    <span class="nt">&lt;tstamp&gt;</span>
        <span class="nt">&lt;format</span> <span class="na">property=</span><span class="s">&quot;build.time&quot;</span> <span class="na">pattern=</span><span class="s">&quot;%Y-%m-%d %H:%I&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/tstamp&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;twitter.status&quot;</span> <span class="na">value=</span><span class="s">&quot;Staging build completed at ${build.time}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;tweet&quot;</span> <span class="nt">/&gt;</span>
</code></pre>
</div>


<p>This will post the message to twitter, replacing the <code lang="php" inline="true">${build.time}</code> token by the actual build and time.</p>

<p>Do you use Phing for your webapp build and deployment? If so, please share any custom tasks you might have created.</p>

</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'geekynuggets'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    // var disqus_identifier = 'unique_dynamic_id_1234';
    // var disqus_url = 'http://example.com/permalink-to-page.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
<div id="primary" class="widget-area" role="complementary">
<ul class="xoxo">
    <li id="archives-3" class="widget-container widget_archive">
        <h3 class="widget-title">Archives</h3>
        <ul>
            <li><a href='http://jfoucher.com/2011/08' title='August 2011'>August 2011</a></li>
            <li><a href='http://jfoucher.com/2011/06' title='June 2011'>June 2011</a></li>
            <li><a href='http://jfoucher.com/2011/04' title='April 2011'>April 2011</a></li>
            <li><a href='http://jfoucher.com/2011/02' title='February 2011'>February 2011</a></li>
            <li><a href='http://jfoucher.com/2011/01' title='January 2011'>January 2011</a></li>
            <li><a href='http://jfoucher.com/2010/05' title='May 2010'>May 2010</a></li>
            <li><a href='http://jfoucher.com/2010/01' title='January 2010'>January 2010</a></li>
            <li><a href='http://jfoucher.com/2009/12' title='December 2009'>December 2009</a></li>
            <li><a href='http://jfoucher.com/2009/11' title='November 2009'>November 2009</a></li>
            <li><a href='http://jfoucher.com/2009/10' title='October 2009'>October 2009</a></li>
            <li><a href='http://jfoucher.com/2009/07' title='July 2009'>July 2009</a></li>
            <li><a href='http://jfoucher.com/2009/06' title='June 2009'>June 2009</a></li>
            <li><a href='http://jfoucher.com/2009/05' title='May 2009'>May 2009</a></li>
            <li><a href='http://jfoucher.com/2009/04' title='April 2009'>April 2009</a></li>
            <li><a href='http://jfoucher.com/2006/03' title='March 2006'>March 2006</a></li>
            <li><a href='http://jfoucher.com/2005/04' title='April 2005'>April 2005</a></li>
            <li><a href='http://jfoucher.com/2005/03' title='March 2005'>March 2005</a></li>
            <li><a href='http://jfoucher.com/2004/11' title='November 2004'>November 2004</a></li>
            <li><a href='http://jfoucher.com/2004/10' title='October 2004'>October 2004</a></li>
            <li><a href='http://jfoucher.com/2004/09' title='September 2004'>September 2004</a></li>
            <li><a href='http://jfoucher.com/2004/08' title='August 2004'>August 2004</a></li>
            <li><a href='http://jfoucher.com/2004/04' title='April 2004'>April 2004</a></li>
            <li><a href='http://jfoucher.com/2004/03' title='March 2004'>March 2004</a></li>
        </ul>
    </li>
    <li id="text-6" class="widget-container widget_text">
        <div class="textwidget">
            <a href="http://stackoverflow.com/users/210824/jfoucher">
<img src="http://stackexchange.com/users/flair/f354d74ced334d5984ea2db33cf8024a.png" width="208" height="58" alt="profile for jfoucher on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for jfoucher on Stack Exchange, a network of free, community-driven Q&amp;A sites"> 
</a> 
<div style="margin-right:15px;float:left;"><a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical">Tweet</a></div><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script> 
<g:plusone size="tall" count="true"></g:plusone> 
<iframe src="http://www.facebook.com/plugins/like.php?app_id=228358510507833&amp;href&amp;send=false&amp;layout=box_count&amp;width=50&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font=segoe+ui&amp;height=60" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:50px; height:60px;margin-left:25px" allowTransparency="true"></iframe></div> 
		</li><li id="recent-comments-3" class="widget-container widget_recent_comments"><h3 class="widget-title">Recent Comments</h3><ul id="recentcomments"><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2011/04/css-minification-library-for-codeigniter.html#comment-14518"><!--:en-->CSS minification library for codeigniter<!--:--></a> (2)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2011/01/python-skype-notifier-for-ubuntu.html#comment-12631"><!--:en-->Python skype notifier for Ubuntu<!--:--></a> (15)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2009/06/wpfeedly-theme-download.html#comment-12060"><!--:en-->WP-Feedly theme available for download<!--:--></a> (6)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2011/01/wordpress-email-404-notification.html#comment-10882">WordPress 404 notification by email</a> (2)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2009/06/auto-tag-wordpress-plugin.html#comment-9966"><!--:en-->Auto Tag WordPress plugin<!--:--></a> (44)</li></ul></li><li id="text-8" class="widget-container widget_text"><h3 class="widget-title">Subscribe</h3>			<div class="textwidget"><ul> 
<li> 
<a href="http://feeds.feedburner.com/GeekyNuggets" rel="alternate" type="application/rss+xml">Subscribe in a reader</a>&nbsp;<a href="http://feeds.feedburner.com/GeekyNuggets" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a></li> 
<li> 
<a href="http://feedburner.google.com/fb/a/mailverify?uri=GeekyNuggets&amp;loc=en_US">Subscribe by Email</a>&nbsp;<a href="http://feedburner.google.com/fb/a/mailverify?uri=GeekyNuggets&amp;loc=en_US"><img src="/wp-content/themes/jfoucher/images/icon_email_small.gif" style="vertical-align:middle;border:0" alt="" /></a></li></ul></div> 

</li>
</ul>

</div><!-- #primary .widget-area -->
</div>
<!--End #main -->
<div id="footer">
</div>
<script type="text/javascript" src="http://use.typekit.com/mmi3jba.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>


</body>
</html>

