<!DOCTYPE html> 
<html lang="en">
<!--
	Access keys:
		H = homepage
		S = search input field
		L = latest article on the homepage
		A = about page
-->
<head>
    <title>
        A Phing task to update your Twitter status
        
    </title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta http-equiv="content-language" content="en" />
	<meta name="author" content="Jonathan Foucher" />
	<meta name="designer" content="Jonathan Foucher" />
	<meta name="developer" content="Jonathan Foucher" />
	<meta name="description" content="Phing, a build tool for PHP, written in PHP, allows one to do practically anything when building your project. Today we write a custom task to update your twitter status upon a succcessfull build" />
	<meta name="keywords" content="Web development, france, wordpress, codeigniter, linux, ubuntu, debian, system administration" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<link rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/en/" />
	<link rel="stylesheet/less" href="/assets/css/screen.less" type="text/css" media="screen" />
    <!--<link rel="stylesheet" href="/assets/css/screen.css" type="text/css" media="screen" />-->
    <script src="/assets/js/less-1.1.4.js" type="text/javascript"></script>
    
	<link rel="alternate" href="http://feeds.feedburner.com/GeekyNuggets" title="Geeky Nuggets" type="application/atom+xml" />

	<link rel="shortcut icon" type="image/png" href="/favicon.png" />

</head>
<body>

	<div id="container" class="clearfix">
		                <header id="header" class="center">
            <div class="logo">
                <a href="/" title="Return to homepage" tabindex="0" accesskey="H">
                    <span class="hoverline">Geeky Nuggets</span>
                </a>
            </div>
                    <nav id="nav" class="clear">
            <ul class="nav nav-header caps">
				<li><a href="/about.html#notebook" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the blog archives" tabindex="0">Archives</a></li>
				<li><a href="/projects/#notebook" title="Go to the code portfolio of Jonathan Foucher" tabindex="0">Projects</a></li>
				<li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Subscribe to my posts, by email or in your feed reader" tabindex="0">Feed</a></li>
            </ul>
			<div class="sitesearch">

                <!-- Google Custom Search Element -->
                <form action="http://www.google.com/cse" class="center_column" id="searchForm" >
                    <fieldset>
                       <input type="hidden" name="cx" value="004905032692135561336:flcwnz7i1ww" />
                       <input type="hidden" name="ie" value="UTF-8" />
                       <label for="search" class="hidden">Search</label>
                       <input id="search" class="text-input" type="text" name="q" size="15" tabindex="0" accesskey="S" />
                       <input id="searchsubmit" type="submit" name="sa" value="Search" tabindex="0" />
                    </fieldset>
                </form>

            </div>

        </nav> <!-- /#nav.clear -->

            <div class="siteDesc"><a href="/about.html#notebook" title="About Jonathan Foucher
                &amp; contact details" tabindex="0" accesskey="A">Jonathan Foucher</a>&rsquo;s blog <span
                class="amp">&amp;</span> web development
                notebook.
            </div>
            <div class="hero">

                <p>
                    Phing, a build tool for PHP, written in PHP, allows one to do practically anything when building your project. Today we write a custom task to update your twitter status upon a succcessfull build
                </p>
			</div>
		</header> <!-- /#header.center -->

		<div id="notebook" class="center clear">
			<div class="page-nav-top">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2011/04/css-minification-library-for-codeigniter.html#notebook" title="View CSS minification library for codeigniter">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/08/remote-debugging-with-xdebug-and-phpstorm-on-ubuntu.html#notebook" title="View Remote debugging with Xdebug and PhpStorm on Ubuntu">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-top -->

            <h2 class="clear">A Phing task to update your Twitter status</h2>
            <span class="date" title="2011-06-29T14:10:00+02:00">
                <span class="published">Published&thinsp;&bull;</span>
                <span class="day">29</span>
                <span class="month"><abbr>Jun</abbr></span>
                <span class="year">2011</span>
            </span>
            <div id="entry-content">
                <h3>Phing and Twitter</h3>


<p>I recently starting working with <a title="PHP build and deployment tool" href="http://www.phing.info">phing</a> to automate the build and deployement process for the web apps I'm building. I use it to compile my LESS files to CSS and minimize then, to compress and concatenate the javascript files, to optimize images using <a href="http://www.smushit.com/">smushit</a>, etc...</p>

<p>I like to be able to comunicate exactly what I'm doing, and thankfully Phing has a built in task to email a message to a list of recipients, which is good, but slightly old school. I wanted something that would be able to integrate readily with twitter, i.e. update my status when a build was completed. I saw <a href="http://codeinthehole.com/archives/14-Phing-task-to-update-Twitter-status.html">this post</a>, which unfortunately uses Basic Auth. As you doubtless know, <a href="http://dev.twitter.com/pages/basic_auth_shutdown">Twitter deprecated this form of authentication</a>, and now asks all users to authenticate using <a href="http://dev.twitter.com/pages/basic_to_oauth">OAuth</a>.</p>

<h3>Download twitterOAuth library</h3>


<p>That meant I had to roll my own phing task... However, thanks to great work by cleverer people, doing it was quite simple. Using <a href="http://abrah.am/">Abraham Williams'</a> <a href="https://github.com/abraham/twitteroauth">twitteroauth</a> library means that the coding I'd have to do was greatly reduced. Awesome, because <a href="http://www.codinghorror.com/blog/2005/08/how-to-be-lazy-dumb-and-successful.html">I aim to be lazy</a>.</p>

<p>The first step is to <a href="https://github.com/abraham/twitteroauth/tarball/master">download the twitteroauth library</a> from github. Extract it to a temporary folder and copy the subfolder</p>

<div class="highlight"><pre><code class="bash">twitteroauth
</code></pre>
</div>


<p> to the folder where your fing tasks are stored (on my system it is</p>

<div class="highlight"><pre><code class="bash">/usr/share/php/phing/tasks/my/
</code></pre>
</div>


<p>. Please note you might have to create the</p>

<div class="highlight"><pre><code class="bash">my/
</code></pre>
</div>


<p> folder within</p>

<div class="highlight"><pre><code class="bash">/usr/share/php/phing/tasks/
</code></pre>
</div>


<p>. You will need root privileges for these steps.</p>

<h3>Register application with Twitter</h3>


<p>Secondly, you need to <a href="https://dev.twitter.com/apps/new">register an application with twitter</a>, as you will need a consumer key and consumer secret later on. Please <a href="https://dev.twitter.com/apps/new">do so now</a>, and come back once you have your app data available.</p>

<h3>Create the custom phing task</h3>


<p>Next up is creating the actual task PHP class. Create an empty file named TwitterUpdateTask.php</p>

<div class="highlight"><pre><code class="bash">sudo touch /usr/share/php/phing/tasks/my/TwitterUpdateTask.php
</code></pre>
</div>


<p> and open it for editing with your favorite editor. We'll use gedit :</p>

<div class="highlight"><pre><code class="bash">gksu gedit /usr/share/php/phing/tasks/my/TwitterUpdateTask.php
</code></pre>
</div>


<p>The code for this file is as shown below:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="p">(</span><span class="s2">&quot;phing/Task.php&quot;</span><span class="p">);</span>
<span class="k">require_once</span> <span class="p">(</span><span class="s2">&quot;phing/tasks/my/twitteroauth/twitteroauth.php&quot;</span><span class="p">);</span>


<span class="cm">/* get the lines below from http://twittertokens.6px.eu/ */</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CONSUMER_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Consumer Key Here&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CONSUMER_SECRET&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Consumer Secret Here&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OAUTH_TOKEN&#39;</span><span class="p">,</span> <span class="s1">&#39;Your OAuth Token Here&#39;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OAUTH_TOKEN_SECRET&#39;</span><span class="p">,</span> <span class="s1">&#39;Your Oauth Token Secret Here&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">TwitterUpdateTask</span> <span class="k">extends</span> <span class="nx">Task</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nv">$message</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * The setter for the status message</span>
<span class="cm">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMessage</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">=</span><span class="nv">$str</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">public</span> <span class="k">function</span> <span class="nf">main</span><span class="p">(){</span>
        <span class="cm">/* Connect to twitter */</span>
        <span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TwitterOAuth</span><span class="p">(</span><span class="nx">CONSUMER_KEY</span><span class="p">,</span> <span class="nx">CONSUMER_SECRET</span><span class="p">,</span> <span class="nx">OAUTH_TOKEN</span><span class="p">,</span> <span class="nx">OAUTH_TOKEN_SECRET</span><span class="p">);</span>
        <span class="cm">/* Pass the status message as a parameter */</span>
        <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">);</span>
        <span class="cm">/* Post the data to the API endpoint */</span>
        <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;statuses/update&#39;</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">)){</span>
            <span class="cm">/* if there is an error, fail the build */</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">BuildException</span><span class="p">(</span><span class="nv">$status</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="cm">/* if there is no error, show a success message */</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="p">(</span><span class="s2">&quot;Status posted to twitter&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>




<h3>Get the OAuth token and secret</h3>


<p>Don't close this file, we still need to add the authentication data to it. You can already place your consumer key and consumer secret in the apropriate</p>

<div class="highlight"><pre><code class="php"><span class="x">define()</span>
</code></pre>
</div>


<p> calls (the first two lines), but if not, we'll do it now.</p>

<p>Navigate to <a href="http://twittertokens.6px.eu">http://twittertokens.6px.eu</a>, put your consumer data and consumer secret in the apropriate fields and click on "Sign in with Twitter". A twitter page will open asking for your confirmation. Click "Sign in" and you are redirected to http://twittertokens.6px.eu/. You should see 4 lines of code appear, that look like this:</p>

<div class="highlight"><pre><code class="php"><span class="x">define(&#39;CONSUMER_KEY&#39;, &#39;V1UsnZJrgfhgKJFoqsQ&#39;);</span>
<span class="x">define(&#39;CONSUMER_SECRET&#39;, &#39;UUazcBfXrWW1jcpiSU564hg654t1EMki8gzptQU&#39;);</span>
<span class="x">define(&#39;OAUTH_TOKEN&#39;, &#39;325454656-EuCudghg8tTYwKf9yjt5nhqr14i5egHJPeVRGVxQv&#39;);</span>
<span class="x">define(&#39;OAUTH_TOKEN_SECRET&#39;, &#39;gh6854hg6tyGEvGEiEi15XmUtOmDpaONM&#39;);</span>
</code></pre>
</div>


<p>Copy this code to the corresponding spot in the TwitterUpdateTask.php file, overwriting what's already there.</p>

<p>Please note though that I'm not making any claims as to how secure this is or whatever. I don't store any of your data anywhere, but if sending your application consumer token and secret worries you, find another way to get the Oauth tokens.</p>

<h3>Create the build file</h3>


<p>First, we define the custom task:</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;taskdef</span> <span class="na">name=</span><span class="s">&quot;twitterupdate&quot;</span> <span class="na">classname=</span><span class="s">&quot;phing.tasks.my.TwitterUpdateTask&quot;</span> <span class="nt">/&gt;</span>
</code></pre>
</div>


<p>Secondly, let's create a custom target that will send a tweet with the message we want.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;tweet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;twitterupdate</span> <span class="na">message=</span><span class="s">&quot;${twitter.status}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/target&gt;</span>
</code></pre>
</div>


<p>Now we can call this task from another one, but we need to make that the twitter.status is set. Let's we have a "staging" target. Part of it could look like this:</p>

<div class="highlight"><pre><code class="xml">    <span class="c">&lt;!-- Set the timestamp to be used in the twitter update --&gt;</span>
    <span class="nt">&lt;tstamp&gt;</span>
        <span class="nt">&lt;format</span> <span class="na">property=</span><span class="s">&quot;build.time&quot;</span> <span class="na">pattern=</span><span class="s">&quot;%Y-%m-%d %H:%I&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/tstamp&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;twitter.status&quot;</span> <span class="na">value=</span><span class="s">&quot;Staging build completed at ${build.time}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;tweet&quot;</span> <span class="nt">/&gt;</span>
</code></pre>
</div>


<p>This will post the message to twitter, replacing the</p>

<div class="highlight"><pre><code class="php"><span class="x">${build.time}</span>
</code></pre>
</div>


<p> token by the actual build and time.</p>

<p>Do you use Phing for your webapp build and deployment? If so, please share any custom tasks you might have created.</p>

                <div class="meta">
                    <!-- <span class="pdf">Download a <a href="/2011/06/phing-task-to-update-twitter-status.html.pdf" title="Download a PDF, printer-friendly copy of this article"><acronym title="Portable Document Format">PDF</acronym>, printer-friendly version of this article</a>.</span> -->
                    <span class="permalink">For referencing: <a href="/2011/06/phing-task-to-update-twitter-status.html" title="[Permalink] A Phing task to update your Twitter status">permalink to this article</a>.</span>
                </div> <!-- /.meta -->
            </div> <!-- /.entry-content.colEight -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'geekynuggets'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

            <div class="page-nav-bottom">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2011/04/css-minification-library-for-codeigniter.html#notebook" title="View CSS minification library for codeigniter">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/08/remote-debugging-with-xdebug-and-phpstorm-on-ubuntu.html#notebook" title="View Remote debugging with Xdebug and PhpStorm on Ubuntu">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-bottom -->
        </div> <!-- /#notebook.center.clear -->

	</div>
    <footer id="footer" class="clear">
        <ul class="nav nav-footer caps">
            <li><a href="/about.html" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
            <li><a href="/archives.html#cover" title="View the blog archives" tabindex="0">Blog</a></li>
            <li><a href="/projects/#notebook" title="Go to the code portfolio of Jonathan Foucher" tabindex="0">Projects</a></li>
            <li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Feed link" tabindex="0">Feed</a></li>
        </ul>
        <span class="backtop floatRight"><a class="internal" href="#header" title="Return to the top of this page">Back to top &uarr;</a></span>
        <div class="page-meta clear">
            <div class="info">

                <p class="copyright ">
                    This blog has been online in one form or another since
                    <span class="date" title="March 2004">2004</span>&thinsp;&mdash;&thinsp;copyright &copy; Jonathan
                    Foucher.&thinsp;&mdash;&thinsp;<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"
                       title="You can use this for non-comercial purposes, provided you cite me as the author, and do not modify the content">
                        Creative Commons License
                    </a>.
                </p>
            </div>

        </div> <!-- /.page-meta.clear -->
    </footer> <!-- /#footer.center.clear -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>

    <script src="/assets/js/jquery.timeago.js" type="text/javascript"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8465441-2']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +
        '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    </script>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</body>
</html>