<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="description" content="A blog about web development, codeigniter and wordpress, by web developer Jonathan Foucher" />
<title>Compile custom kernel on Ubuntu 10.10</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css"  href="/assets/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/assets/css/pygments.css" />
<link rel="icon" href="/favicon.png" type="image/png" />
    
<meta name="viewport"
  content="width=device-width,
  minimum-scale=1.0, maximum-scale=1.0" />
</head>

<body>
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">

			<div id="access" role="navigation">
				<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
                <div class="menu-header">
    <ul id="menu-new" class="menu">
        <li class="menu-item">
            <a href="http://jfoucher.com">Blog</a>
        </li>
        <li class="menu-item">
            <a title="view my page on about.me" href="http://about.me/jfoucher">About
me</a>
        </li>
        <li class="menu-item">
            <a title="latest works" href="http://jfoucher.fr/">Portfolio</a>
        </li>
        <li class="menu-item"><a title="feedly inspired theme" href="http://jfoucher.com/wp-feedly">WP Feedly</a>
        </li>
    </ul>
</div>

			</div><!-- #access -->
			<div id="branding" role="banner">
				
                <div id="site-title">
                  
					<span>
						<a href="/" title="Geeky Nuggets" rel="home">Geeky Nuggets</a>
					</span>
				
                </div>
                  

				<div id="site-description">Jonathan Foucher's blog <span class="amp">&amp;</span> web development notebook</div>
			</div><!-- #branding -->

		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">


<div id="content">


    <div id="nav-above" class="navigation">
    

    <div class="nav-previous">
        <a href="/2010/05/19/version-autotag-plugin-released.html" rel="prev" title="View New version of the auto-tag plugin released!">
            <span class="meta-nav">‚Üê</span> New version of the auto-tag plugin released!</a></div>

          
    

    <div class="nav-next">
        <a href="/2011/01/14/python-skype-notifier-for-ubuntu.html" rel="prev" title="View Python skype notifier for Ubuntu">Python skype notifier for Ubuntu <span class="meta-nav">‚Üí</span></a></div>

          
</div>
    <div id="/2011/01/12/compile-custom-kernel-on-ubuntu-10-10.html" class="post">
        
<p class="the-date">12 January 2011</p>
<h2 class="entry-title"><a href="/2011/01/12/compile-custom-kernel-on-ubuntu-10-10.html" title="Permanent link to " rel="bookmark">Compile custom kernel on Ubuntu 10.10</a></h2>


<p>First off, you want to grab the latest kernel source from†<a href="http://kernel.org/">http://kernel.org/</a> and save it to a folder on your computer. I used my browser's default : <code inline="true" lang="bash">~/Downloads</code>. Right click on the archive and select "extract here"</p>

<h3>Configuration</h3>


<p>Open a terminal, "cd" to your source directory, in my case <code inline="true" lang="bash">cd ~/Downloads/linux-2.6.37</code> and run <code inline="true" lang="bash">make gconfig</code> if using Ubuntu or <code inline="true" lang="bash">make kconfig</code> if running Kubuntu. At that point, you'll need to know a fair bit about your system's hardware, to select only the options that are applicable. I like to reuse my current config as a starting point, so if you are using the default ubuntu kernel, the configuration used is stored in the <code inline="true">/boot</code> directory, with names like <code inline="true">config-2.6.35-24-generic</code> Copy the latest one to your linux source directory. When the configuration editor is loaded, choose <code inline="true">File >> Load</code> and select the file you just copied over. Now the Ubuntu default configuration is loaded. If you were to compile your kernel you would get the same kind of system you have now : functional but suboptimal.</p>

<p>We'll try and better that a bit.</p>

<p>The first submenu I open is Processor type and features. In there, I disable everything related to SMP and Paravirtualized guest support as I do not plan to run this as a VM guest. I choose the type of processor appropriate to my machine, in this case "new Xeon"</p>

<p>You can use <code inline="true" lang="bash">make localmodconfig</code> which will disable all the modules not currently loaded from your config file. Be careful though, because if there are devices and/of file systems you're not using at the moment, the drivers won't be added.</p>

<h3>Compiling and instalation</h3>


<p>Once you're happy with the configuration, save and close the editor, and run <code inline="true" lang="bash">make all</code> or <code inline="true" lang="bash">make -j4 all</code> on multicore processors to run several processes in parallel, which will compile the kernel and the modules specified in the .config file</p>

<p>That's the regular debian method, in which you have to run mkinitrd afterwards. I ended up doing it <a href="https://help.ubuntu.com/community/Kernel/Compile">the ubuntu way</a>, where you create .deb packages you can later install with your preferred package manager.</p>

<blockquote>
<p class="line862">If you re-used the existing configuration, note that Ubuntu kernels build with debugging information on, which makes the resulting kernel modules (*.ko files) much larger than they would otherwise be. To turn this off, go into the config's "Kernel hacking"&lt;!-- ; then, under "Kernel debugging", --&gt; and turn OFF "Compile the kernel with debug info".</p>
<p class="line874">Now you can compile the kernel and create the packages:</p>
<code lang="bash">make-kpkg clean # only needed if you want to do a "clean" build
fakeroot make-kpkg --initrd --append-to-version=-some-string-here kernel-image kernel-headers</code></blockquote>


<p style="text-align: center;"><img class="aligncenter" src="http://media.tumblr.com/tumblr_let0e9SCP01qzbvjd.png" alt="" width="500" height="338" /></p>


<p>Much easier...</p>

<h3>Drivers</h3>


<p>Of course, if you're using non-free drivers, you'll want to reinstall them. The first time I booted the new kernel, X did not start because it couldn't load the nvidia kernel module. Luckily, I had the latest driver around from a previous install, so installed straight away from the command line.</p>

<p>You should now have a working Ubuntu install running your own custom kernel. Of course, you are responsible for upgradin kernel and binary drivers, as the updates from Ubuntu are not going to work any longer... Although I'm not so sure about that. I'll see in a while I guess.</p>

<h3>Done!</h3>


<p>Anyway, in my case this upgrade is really worth it because I get a functioning built-in microphone on my Vaio! Yay!</p>

<p>So the moral is: don't be scared of trying a custom kernel, it really got much easier, and if you don't like it, going back is as easy as selecting another entry in grub...</p>

</div>

    </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'geekynuggets'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    // var disqus_identifier = 'unique_dynamic_id_1234';
    // var disqus_url = 'http://example.com/permalink-to-page.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
<div id="primary" class="widget-area" role="complementary">
<ul class="xoxo">
    <li id="archives-3" class="widget-container widget_archive">
        <h3 class="widget-title">Archives</h3>
        <ul>
            <li><a href='http://jfoucher.com/2011/08' title='August 2011'>August 2011</a></li>
            <li><a href='http://jfoucher.com/2011/06' title='June 2011'>June 2011</a></li>
            <li><a href='http://jfoucher.com/2011/04' title='April 2011'>April 2011</a></li>
            <li><a href='http://jfoucher.com/2011/02' title='February 2011'>February 2011</a></li>
            <li><a href='http://jfoucher.com/2011/01' title='January 2011'>January 2011</a></li>
            <li><a href='http://jfoucher.com/2010/05' title='May 2010'>May 2010</a></li>
            <li><a href='http://jfoucher.com/2010/01' title='January 2010'>January 2010</a></li>
            <li><a href='http://jfoucher.com/2009/12' title='December 2009'>December 2009</a></li>
            <li><a href='http://jfoucher.com/2009/11' title='November 2009'>November 2009</a></li>
            <li><a href='http://jfoucher.com/2009/10' title='October 2009'>October 2009</a></li>
            <li><a href='http://jfoucher.com/2009/07' title='July 2009'>July 2009</a></li>
            <li><a href='http://jfoucher.com/2009/06' title='June 2009'>June 2009</a></li>
            <li><a href='http://jfoucher.com/2009/05' title='May 2009'>May 2009</a></li>
            <li><a href='http://jfoucher.com/2009/04' title='April 2009'>April 2009</a></li>
            <li><a href='http://jfoucher.com/2006/03' title='March 2006'>March 2006</a></li>
            <li><a href='http://jfoucher.com/2005/04' title='April 2005'>April 2005</a></li>
            <li><a href='http://jfoucher.com/2005/03' title='March 2005'>March 2005</a></li>
            <li><a href='http://jfoucher.com/2004/11' title='November 2004'>November 2004</a></li>
            <li><a href='http://jfoucher.com/2004/10' title='October 2004'>October 2004</a></li>
            <li><a href='http://jfoucher.com/2004/09' title='September 2004'>September 2004</a></li>
            <li><a href='http://jfoucher.com/2004/08' title='August 2004'>August 2004</a></li>
            <li><a href='http://jfoucher.com/2004/04' title='April 2004'>April 2004</a></li>
            <li><a href='http://jfoucher.com/2004/03' title='March 2004'>March 2004</a></li>
        </ul>
    </li>
    <li id="text-6" class="widget-container widget_text">
        <div class="textwidget">
            <a href="http://stackoverflow.com/users/210824/jfoucher">
<img src="http://stackexchange.com/users/flair/f354d74ced334d5984ea2db33cf8024a.png" width="208" height="58" alt="profile for jfoucher on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for jfoucher on Stack Exchange, a network of free, community-driven Q&amp;A sites"> 
</a> 
<div style="margin-right:15px;float:left;"><a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical">Tweet</a></div><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script> 
<g:plusone size="tall" count="true"></g:plusone> 
<iframe src="http://www.facebook.com/plugins/like.php?app_id=228358510507833&amp;href&amp;send=false&amp;layout=box_count&amp;width=50&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font=segoe+ui&amp;height=60" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:50px; height:60px;margin-left:25px" allowTransparency="true"></iframe></div> 
		</li><li id="recent-comments-3" class="widget-container widget_recent_comments"><h3 class="widget-title">Recent Comments</h3><ul id="recentcomments"><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2011/04/css-minification-library-for-codeigniter.html#comment-14518"><!--:en-->CSS minification library for codeigniter<!--:--></a> (2)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2011/01/python-skype-notifier-for-ubuntu.html#comment-12631"><!--:en-->Python skype notifier for Ubuntu<!--:--></a> (15)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2009/06/wpfeedly-theme-download.html#comment-12060"><!--:en-->WP-Feedly theme available for download<!--:--></a> (6)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2011/01/wordpress-email-404-notification.html#comment-10882">WordPress 404 notification by email</a> (2)</li><li class="recentcomments"><a class="comment-post-title-link" href="http://jfoucher.com/2009/06/auto-tag-wordpress-plugin.html#comment-9966"><!--:en-->Auto Tag WordPress plugin<!--:--></a> (44)</li></ul></li><li id="text-8" class="widget-container widget_text"><h3 class="widget-title">Subscribe</h3>			<div class="textwidget"><ul> 
<li> 
<a href="http://feeds.feedburner.com/GeekyNuggets" rel="alternate" type="application/rss+xml">Subscribe in a reader</a>&nbsp;<a href="http://feeds.feedburner.com/GeekyNuggets" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a></li> 
<li> 
<a href="http://feedburner.google.com/fb/a/mailverify?uri=GeekyNuggets&amp;loc=en_US">Subscribe by Email</a>&nbsp;<a href="http://feedburner.google.com/fb/a/mailverify?uri=GeekyNuggets&amp;loc=en_US"><img src="/wp-content/themes/jfoucher/images/icon_email_small.gif" style="vertical-align:middle;border:0" alt="" /></a></li></ul></div> 

</li>
</ul>

</div><!-- #primary .widget-area -->
</div>
<!--End #main -->
<div id="footer">
</div>
<script type="text/javascript" src="http://use.typekit.com/mmi3jba.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>


</body>
</html>

