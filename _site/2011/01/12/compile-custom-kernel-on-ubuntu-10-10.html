<!DOCTYPE html> 

<html lang="en">

<!-- 
	Access keys:
		H = homepage
		S = search input field
		L = latest article on the homepage
		F = portfolio
		A = about page
		
		N = next portfolio preview item
		P = previous prtoflio preview item
-->
<head>
    <title>Compile custom kernel on Ubuntu 10.10</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta http-equiv="content-language" content="en" />
	<meta name="author" content="Jonathan Foucher" />
	<meta name="designer" content="Jonathan Fouch" />
	<meta name="developer" content="Jonathan Foucher" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="robots" content="noydir, noopd" /> <!-- Opt out of ODP -->
	
	<link rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/en/" />
	<link rel="stylesheet" href="/assets/css/reset.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/assets/css/screen.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/assets/css/print.css" type="text/css" media="print" />
	
    <!-- <link rel="stylesheet" href="/css/syntax.css" type="text/css" media="screen" /> -->
	<link rel="alternate" href="http://feeds.feedburner.com/GeekyNuggets" title="Geeky Nuggets" type="application/atom+xml" />
	
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src="/assets/js/jquery.timeago.js" type="text/javascript"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8465441-2']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +
        '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    </script>
</head>

<body>
	<div id="container">
		                <div id="header" class="center">
            <div class="article-logo floatLeft">
                <h1>
				    <a href="/" title="Return to homepage" tabindex="0" accesskey="H">
				        <span class="hoverline">kle</span><span class="middot">&middot;</span>p<span class="hoverline">as</span>
				    </a>
                </h1>
            </div>
            <div class="hero floatRight colSix">
                <p class="moin">You&#8217;re currently viewing a single article. Feel free to skip back to <a href="/" rel="home" title="Go back to the homepage" tabindex="0">&sect; Index</a> or straight to <a href="/#notebook" title="Skip straight to the latest article" tabindex="0" accesskey="L">&sect; Latest article</a>.</p>
			</div>
		</div> <!-- /#header.center -->
		        <div id="nav" class="clear">
            <ul class="nav nav-header caps">
				<li><a href="/about.html#notebook" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the blog archives" tabindex="0">Archives</a></li>
				<li><a href="http://jfoucher.fr" title="Go to the portfolio" tabindex="0">Portfolio</a></li>
				<li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Feed link" tabindex="0">Feed</a></li>
            </ul>
			<div class="sitesearch floatRight">
                <div class="sitesearch">
                    <!-- Google Custom Search Element -->
                    <form action="http://www.google.com/cse" class="center_column" />
                    <fieldset>
                       <input type="hidden" name="cx" value="004905032692135561336:flcwnz7i1ww" />
                       <input type="hidden" name="ie" value="UTF-8" />
                       <input id="search" class="text-input" type="text" name="q" size="15" tabindex="0" accesskey="S" />
                       <input id="searchsubmit" type="submit" name="sa" value="Search" tabindex="0" />
                    </fieldset>
                </div>
            </div>
			<div class="clear"></div>
        </div> <!-- /#nav.clear -->

		<div id="notebook" class="center clear">
			<div class="page-nav-top">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2010/05/19/version-autotag-plugin-released.html/#notebook" title="View New version of the auto-tag plugin released!">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/01/14/python-skype-notifier-for-ubuntu.html/#notebook" title="View Python skype notifier for Ubuntu">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-top -->
            <div class="entry-content colEight">
                <h2 class="clear">Compile custom kernel on Ubuntu 10.10</h2>
                <span class="date" title="2011-01-12T15:06:02+01:00">
                    <span class="published">Published&thinsp;&bull;</span>
                    <span class="day">12</span>
                    <span class="month"><abbr>Jan</abbr></span>
                    <span class="year">2011</span>
                </span>
                <p>First off, you want to grab the latest kernel source from <a href="http://kernel.org/">http://kernel.org/</a> and save it to a folder on your computer. I used my browser's default : <code inline="true" lang="bash">~/Downloads</code>. Right click on the archive and select "extract here"</p>

<h3>Configuration</h3>


<p>Open a terminal, "cd" to your source directory, in my case <code inline="true" lang="bash">cd ~/Downloads/linux-2.6.37</code> and run <code inline="true" lang="bash">make gconfig</code> if using Ubuntu or <code inline="true" lang="bash">make kconfig</code> if running Kubuntu. At that point, you'll need to know a fair bit about your system's hardware, to select only the options that are applicable. I like to reuse my current config as a starting point, so if you are using the default ubuntu kernel, the configuration used is stored in the <code inline="true">/boot</code> directory, with names like <code inline="true">config-2.6.35-24-generic</code> Copy the latest one to your linux source directory. When the configuration editor is loaded, choose <code inline="true">File >> Load</code> and select the file you just copied over. Now the Ubuntu default configuration is loaded. If you were to compile your kernel you would get the same kind of system you have now : functional but suboptimal.</p>

<p>We'll try and better that a bit.</p>

<p>The first submenu I open is Processor type and features. In there, I disable everything related to SMP and Paravirtualized guest support as I do not plan to run this as a VM guest. I choose the type of processor appropriate to my machine, in this case "new Xeon"</p>

<p>You can use <code inline="true" lang="bash">make localmodconfig</code> which will disable all the modules not currently loaded from your config file. Be careful though, because if there are devices and/of file systems you're not using at the moment, the drivers won't be added.</p>

<h3>Compiling and instalation</h3>


<p>Once you're happy with the configuration, save and close the editor, and run <code inline="true" lang="bash">make all</code> or <code inline="true" lang="bash">make -j4 all</code> on multicore processors to run several processes in parallel, which will compile the kernel and the modules specified in the .config file</p>

<p>That's the regular debian method, in which you have to run mkinitrd afterwards. I ended up doing it <a href="https://help.ubuntu.com/community/Kernel/Compile">the ubuntu way</a>, where you create .deb packages you can later install with your preferred package manager.</p>

<blockquote>
<p class="line862">If you re-used the existing configuration, note that Ubuntu kernels build with debugging information on, which makes the resulting kernel modules (*.ko files) much larger than they would otherwise be. To turn this off, go into the config's "Kernel hacking"&lt;!-- ; then, under "Kernel debugging", --&gt; and turn OFF "Compile the kernel with debug info".</p>
<p class="line874">Now you can compile the kernel and create the packages:</p>
<code lang="bash">make-kpkg clean # only needed if you want to do a "clean" build
fakeroot make-kpkg --initrd --append-to-version=-some-string-here kernel-image kernel-headers</code></blockquote>


<p style="text-align: center;"><img class="aligncenter" src="http://media.tumblr.com/tumblr_let0e9SCP01qzbvjd.png" alt="" width="500" height="338" /></p>


<p>Much easier...</p>

<h3>Drivers</h3>


<p>Of course, if you're using non-free drivers, you'll want to reinstall them. The first time I booted the new kernel, X did not start because it couldn't load the nvidia kernel module. Luckily, I had the latest driver around from a previous install, so installed straight away from the command line.</p>

<p>You should now have a working Ubuntu install running your own custom kernel. Of course, you are responsible for upgradin kernel and binary drivers, as the updates from Ubuntu are not going to work any longer... Although I'm not so sure about that. I'll see in a while I guess.</p>

<h3>Done!</h3>


<p>Anyway, in my case this upgrade is really worth it because I get a functioning built-in microphone on my Vaio! Yay!</p>

<p>So the moral is: don't be scared of trying a custom kernel, it really got much easier, and if you don't like it, going back is as easy as selecting another entry in grub...</p>

                <div class="meta">
                    <!-- <span class="pdf">Download a <a href="/2011/01/12/compile-custom-kernel-on-ubuntu-10-10.html.pdf" title="Download a PDF, printer-friendly copy of this article"><acronym title="Portable Document Format">PDF</acronym>, printer-friendly version of this article</a>.</span> -->
                    <span class="permalink">For referencing: <a href="/2011/01/12/compile-custom-kernel-on-ubuntu-10-10.html" title="[Permalink] Compile custom kernel on Ubuntu 10.10">permalink to this article</a>.</span>
                </div> <!-- /.meta -->
            </div> <!-- /.entry-content.colEight -->
            <div class="page-nav-bottom">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2010/05/19/version-autotag-plugin-released.html/#notebook" title="View New version of the auto-tag plugin released!">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/01/14/python-skype-notifier-for-ubuntu.html/#notebook" title="View Python skype notifier for Ubuntu">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-bottom -->
        </div> <!-- /#notebook.center.clear -->
                <div id="footer" class="center clear">
			<ul class="nav nav-footer caps">
				<li><a href="/about.html" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the notebook entries" tabindex="0">Notebook</a></li>
				<li><a href="/#portfolio" title="Skip back up to the portfolio" tabindex="0">Portfolio</a></li>
				<li><a href="http://feeds.feedburner.com/klepas" title="Feed link" tabindex="0">Feed</a></li>
			</ul>
			<span class="backtop floatRight"><a class="internal" href="#header" title="Return to the top of this page">Back to top &uarr;</a></span>
			<div class="page-meta clear">
				<div class="info">
					<span class="index">&#9758;</span><p class="vcard"><a href="/files/Simon-Pascal-Klein.vcf" title="Download Simon Pascal Klein&rsquo;s addressbook vCard">Add me to your address book via vCard</a>.</p>
					<p class="copyright clear">Proudly bending beziers since <abbr class="date" title="2004">MMIV</abbr>&ndash;; copyright &copy; Simon Pascal Klein thereon.</p>
					<p class="licensing"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/au/" title="Content, unless specificed, licensed under a Creative Commons license">Some rights reserved</a>.</p>
					<p>For an overview of the site, see the <a href="/sitemap/" title="View the site map">site map</a> or <a href="/archives.html#cover" title="View the notebook archives">notebook archives</a>.</p>
					<h2>A playful tumble with <em>type</em>&hellip; &rarr;</h2>
					<p>&hellip;yes, <em>type</em>, not a graphic; try selecting it or resizing the page font size. Inspired by <a href="http://jontangerine.com/" title="jontangerine.com: Jon Tan&rsquo;s website">Jon Tan</a>&rsquo;s masterhead type folly, this is achieved just with some simple nested <code><span class="element">span</span></code> elements that are positioned absolutely against their relative parents, and the entire thing is sized in ems and scales nicely.</p>
				</div>
				<div class="type-folly">
					<em>Type
						<span>set
							<span>with
								<span>love
									<span>{
										<span>&hearts;
											<span>}</span>
										</span>
									</span>
								</span>
							</span>
						</span>
					</em>
					<strong>in
						<span>Georgia
							<span>&amp;
								<span>Museo</span>
							</span>
						</span>
					</strong>
					<span class="markup">&hellip;all in mostly valid <a rel="external" href="http://jigsaw.w3.org/css-validator/check/referer"><acronym title="Cascading Style Sheets">CSS</acronym></a> <span class="amp">&amp;</span> <a rel="external" href="http://validator.w3.org/check?uri=referer"><acronym title="eXtensible Hyper Text Markup Language">XHTML</acronym></a>; as <acronym title="plain old semantic (X)HTML">POSH</acronym> as can be.</span>
				</div>
			</div> <!-- /.page-meta.clear -->
		</div> <!-- /#footer.center.clear -->
	</div>
</body>
</html>
