<!-- 
	Access keys:
		H = homepage
		S = search input field
		L = latest article on the homepage
		F = portfolio
		A = about page
		
		N = next portfolio preview item
		P = previous prtoflio preview item
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:dc="http://purl.org/dc/terms/" xml:lang="en" lang="en">

<head>
    <title>Python skype notifier for Ubuntu</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta http-equiv="content-language" content="en" />
	<meta name="author" content="Simon Pascal Klein" />
	<meta name="designer" content="Simon Pascal Klein" />
	<meta name="developer" content="Simon Pascal Klein" />
	<meta name="description" content="Personal website and portfolio of Simon Pascal Klein, graphic and web designer, typography nutter and User Interface and Experience aficionado residing down-under in Canberra, Australia." />
	<meta name="keywords" content="accessibility, Australia, Canberrra, concept, design, German, graphic, interface, typography, UI, usability, UX, web" />
	<meta name="robots" content="noydir, noopd" /> <!-- Opt out of ODP -->
	
	<link rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/au/" />
	<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="/css/print.css" type="text/css" media="print" />
	
    <!-- <link rel="stylesheet" href="/css/syntax.css" type="text/css" media="screen" /> -->
	
	<link rel="alternate" href="http://feeds.feedburner.com/klepas" title="Simon Pascal Klein" type="application/atom+xml" />
	<!-- Original atom.xml made redundant by feedburner goodness. -->
	<!-- <link rel="alternate" href="/atom.xml" title="Simon Pascal Klein" type="application/atom+xml" /> -->
	
	<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico" />
	
	<script type="text/javascript" src="/js/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="/js/jquery.color.min.js"></script>
	<script type="text/javascript" src="/js/easySlider.min.js"></script>
	<script type="text/javascript">$(document).ready(function(){$("#slider").easySlider();});</script>
	
	<script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-4333113-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>
</head>

<body>
	<div id="container">
		                <div id="header" class="center">
            <div class="article-logo floatLeft">
                <h1>
				    <a href="/" title="Return to homepage" tabindex="0" accesskey="H">
				        <span class="hoverline">kle</span><span class="middot">&middot;</span>p<span class="hoverline">as</span>
				    </a>
                </h1>
            </div>
            <div class="hero floatRight colSix">
                <p class="moin">You&#8217;re currently viewing a single article. Feel free to skip back to <a href="/" rel="home" title="Go back to the homepage" tabindex="0">&sect; Index</a> or straight to <a href="/#notebook" title="Skip straight to the latest article" tabindex="0" accesskey="L">&sect; Latest article</a>.</p>
			</div>
		</div> <!-- /#header.center -->
		        <div id="nav" class="clear">
            <ul class="nav nav-header caps">
				<li><a href="/about.html#notebook" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the notebook archives" tabindex="0">Archives</a></li>
				<li><a href="/#portfolio" title="Skip to the portfolio" tabindex="0">Portfolio</a></li>
				<li><a href="http://feeds.feedburner.com/klepas" title="Feed link" tabindex="0">Feed</a></li>
            </ul>
			<div class="sitesearch floatRight">
                <div class="sitesearch">
                    <!-- Google Custom Search Element -->
                    <form action="http://www.google.com/cse" class="center_column" />
                    <fieldset>
                       <input type="hidden" name="cx" value="012236898957532950839:9eegq1vhwts" />
                       <input type="hidden" name="ie" value="UTF-8" />
                       <input id="search" class="text-input" type="text" name="q" size="15" tabindex="0" accesskey="S" />
                       <input id="searchsubmit" type="submit" name="sa" value="Search" tabindex="0" />
                    </fieldset>
                </div>
            </div>
			<div class="clear"></div>
        </div> <!-- /#nav.clear -->
		<div id="notebook" class="center clear">
			<div class="page-nav-top">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2011/01/12/compile-custom-kernel-on-ubuntu-10-10.html/#notebook" title="View Compile custom kernel on Ubuntu 10.10">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/01/14/spanish-characters-on-qwerty-keyboard-for-ubuntu-10-10.html/#notebook" title="View Spanish characters on Qwerty keyboard for Ubuntu 10.10">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-top -->
            <div class="entry-content colEight">
                <h2 class="clear">Python skype notifier for Ubuntu</h2>
                <span class="date" title="2011-01-14T13:21:52+01:00">
                    <span class="published">Published&thinsp;&bull;</span>
                    <span class="day">14</span>
                    <span class="month"><abbr>Jan</abbr></span>
                    <span class="year">2011</span>
                </span>
                <p>What's the best way to learn a new programming language ? Well, according to <a href="http://programmers.stackexchange.com/q/3519/3984">this question</a> the best (only ?) way to learn a new language is just to code in that language.</p>

<h3>Why Python ?</h3>


<p>Because it's <a href="http://en.wikipedia.org/wiki/Python_(programming_language)#Name_and_neologisms">named after the Monty Python</a></p>

<p>No, seriously, that's why :<a href="http://xkcd.com/353/"><img class="aligncenter size-medium wp-image-201" title="python" src="http://cdn.jfoucher.com/uploads/2011/01/python-264x300.png" alt="I wrote 20 short programs in Python yesterday.  It was wonderful.  Perl, I'm leaving you." width="264" height="300" /></a>No, not this "that's why"! <a href="http://programmers.stackexchange.com/questions/10675/ideal-programming-language-learning-sequence#answer-10748">That one</a></p>

<p>If you are just starting out as a programmer, I cannot recommend <a href="http://learnpythonthehardway.org/">Learn Python The Hard Way</a> highly enough. It is an excellent introduction to the ideas and skills you will need as a programmer, starting from the very basics, like you've never seen a for loop in your life. Actually the first 10 or so lessons do not include ANY control structures!</p>

<p>If on the other hand you  already have some coding experience, I recomend <a href="http://diveintopython.org/">Dive Into Python</a>.  Although it's no quite as hands on as Learn Python the Hard Way, it's a very good book, only covering the basics insofar as they are specific to python.</p>

<h3>Why for <a href="/2011/01/193-compile-custom-kernel-on-ubuntu-10-10.html">Ubuntu</a>?</h3>


<p>That's what I use. Simple as that. Also python and pygtk are included by default, making distribution much easier.</p>

<h3>Why Skype?</h3>


<p>Haven't found out yet. I started developping a backup application in pygtk and glade, a front end to rsync, but got sidetracked reading about the chnges to Ubuntu's <a href="https://wiki.ubuntu.com/DesktopExperienceTeam/ApplicationIndicators">application notifier</a>, ended up interested in the <a href="https://wiki.ubuntu.com/MessagingMenu">messaging notifier</a>, and decided to do something with that.</p>

<p>Skype seemed like the obvious target, given that's it's the only communication application I use that lacks a messaging menu indicator. It does have a systray icon though, so my app is probably superfluous...</p>

<h3>Anyway, to the coding!</h3>


<p><code lang="python"></p>

<h1>!/usr/bin/env python</h1>

<p>import indicate
import gobject
import pynotify
import gtk
import hashlib
import Skype4Py
import urllib
import os
</code></p>

<p>The first line tell the host system to use python to interpret that file</p>

<p>The next lines import the required python modules.</p>

<p>Next, we have to define the main class and declare some variables:
<code lang="python">
class skypeIndicator:</p>

<pre><code>notifShown={}
oldcount={}
count={}
indicator={}
</code></pre>

<p></code>
This is the clas initialization function
<code lang="python"></p>

<pre><code>def __init__(self):
    self.skype= Skype4Py.Skype()
    self.loadSkype()
    #create notification icon
    self.server = indicate.indicate_server_ref_default()
    self.server.set_type("message.im")
    self.server.set_desktop_file("/usr/share/applications/skype.desktop")
    self.server.connect("server-display", self.server_display)
    self.server.show()
    self.create_indicators()
</code></pre>

<p></code>
The first line creates the skype API instance, after which we call the loadSkype() function, which checks if skype is loaded and if not, starts it. We'll look at that function later on.
Next, we create the notification server instance, choose an icon, connect the function server_display to the server-display event (when the icon is clicked on) and finally run the create_indicators function that looks for skype messages and displays them accordingly.</p>

<p><code lang="python"></p>

<pre><code>def loadSkype(self):
    try:
        if not self.skype.Client.IsRunning:
            self.skype.Client.Start()
    except:
        #
        print "Please open skype first"
        self.noSkype()
    try:
        self.skype.Attach()
    except Skype4Py.errors.ISkypeAPIError:
        print "Please open skype first"
        self.noSkype()
</code></pre>

<p></code></p>

<p>This basically tries to start skype if it is not already started and calls noSkype() if it couldn't start it. noSype() shows a notification message to let the user know that they have to start Skype.
<a href="http://cdn.jfoucher.com/uploads/2011/01/skype-not-started.png"><img src="http://cdn.jfoucher.com/uploads/2011/01/skype-not-started.png" alt="Error shown if Skype is not running" title="skype-not-started" width="428" height="213" class="aligncenter size-full wp-image-256" /></a></p>

<p>This next function is where the meat of the process takes place. Please read the inline comments to understand how it works, and ask for clarification by <a href="#respond">posting a comment</a>.</p>

<p><code lang="python"></p>

<pre><code>def create_indicators(self):

    """Loads skype messages, displays them as notification bubbles and also shows them in the messaging menu"""

    #initialize count dictionaries
    self.count={}
    #get unread messages from skype, set self.unread variable
    self.get_messages()

    #self.unread is a dictionary having the username of the sender as key and a list of messages as value
    for name in self.unread:

        # Here we look at the first message from this user to set the messaging menu indicator
        # we only want one indicator per user
        msg=self.unread[name][0]

        #initialize message count for this user
        if name not in self.count:
            self.count[name]=0
        if name not in self.oldcount:
            self.oldcount[name]=0

        # if this user doesn't have his indicator yet
        if name not in self.indicator:
            # create indicator
            self.indicator[name] = indicate.Indicator()
            print "creating indicator"

            # Set indicator properties
            self.fullname=self.name_from_handle(name)
            self.indicator[name].set_property("subtype", "im")
            self.indicator[name].set_property("sender", self.fullname )
            self.indicator[name].set_property("handle", name)

            #this gets the most user-friendly name available for this user
            user=self.user_from_handle(name)

            # get an avatar for this user
            try:
                # This will only work on windows
                self.file=name + '.jpg'
                user.SaveAvatarToFile(file)
            except Skype4Py.errors.ISkypeError:
                # So on linux we use a generated monster ID. Fun but useless!
                h=hashlib.md5(name).hexdigest()
                #TODO find a way to get skype avatars on linux
                urllib.urlretrieve('http://friedcellcollective.net/monsterid/monster/%s/64' % h,name + '.jpg')
                self.file=name + '.jpg'

            #convert the imge to a pixbuf
            pixbuf=gtk.gdk.pixbuf_new_from_file(self.file)
            # for use in the indicator
            self.indicator[name].set_property_icon("icon", pixbuf)

            # set the timestamp of the indicator (this is what makes the indicator display the time since the message was received
            self.indicator[name].set_property_time("time", msg.Timestamp)

            self.indicator[name].show()
            # when the user clicks on the indicator message, open the skype messaging window for this user
            self.indicator[name].connect("user-display", self.display_msg)

        msgbody = ''
        #reverse list so latest message is at the bottom
        for eachmsg in self.unread[name][::-1]:
            # msgbody contains all the messages from that user so far
            msgbody += eachmsg.Body + "\n"

        # We set this person's indicator body to the compound text
        self.indicator[name].set_property("body", msgbody)

        # if there are more than one message from this user, we set the indicator count to be displayed in the messaging menu.
        # Otherwise the time elapsed since receiving the message will be shown
        if self.count[name] &gt; 1:
            self.indicator[name].set_property("count", str(self.count[name]))

        # If a new message arrived since last time checked, mark notification as not shown
        if self.count[name] &gt; self.oldcount[name]:
            self.notifShown[name]=False

        #If notification marked as not shown, show it
        if not self.notifShown.get(name, False) and self.showNotification(self.fullname, msgbody, self.file):
            #mark notification as shown
            self.notifShown[name]=True

            self.indicator[name].set_property("draw-attention", "true")
            self.indicator[name].show()
            print "notification shown for", name

        print "%d messages from %s" %(self.count[name],name)
    # Set oldcountt variable for next loop
    self.oldcount=self.count
    # Loop runs as long as true is returned
    return True
</code></pre>

<p></code></p>

<p>When a new messages arrives, this is what the messaging menu looks like
<a href="http://cdn.jfoucher.com/uploads/2011/01/skype-indicator-menu.png"><img src="http://cdn.jfoucher.com/uploads/2011/01/skype-indicator-menu.png" alt="Messaging menu open qith unread messages" title="skype-indicator-menu" width="376" height="256" class="aligncenter size-full wp-image-258" /></a></p>

<p>The function that gets unread skype messages is as follows For each message, we add it to a list containg the messages from a particular user in the self.unread dictionary.</p>

<p><code lang="python"></p>

<pre><code>def get_messages(self):
    print "checking messages"
    self.unread={}

    for msg in self.skype.MissedMessages:
        display_name = msg.FromHandle
        if display_name not in self.count:
            self.count[display_name]=0
        if not display_name in self.unread:
            self.unread[display_name]=[]

        self.unread[display_name].append(msg)
        self.count[display_name]+=1
    return self.unread
</code></pre>

<p></code></p>

<p>The next two functions are in charge of getting the skype user username as well as the friendliest name available.</p>

<p><code lang="python"></p>

<pre><code>def name_from_handle(self,handle):
    user=self.skype.User(handle)
    if user.FullName:
        return user.FullName
    elif user.DisplayName:
        return user.DisplayName
    else:
        return handle

def user_from_handle(self,handle):
    return self.skype.User(handle)
</code></pre>

<p></code></p>

<p>Below is the generic function in charge of showing popup notifications.</p>

<p><code lang="python"></p>

<pre><code>def showNotification(self, title, message,file=None):
    '''takes a title and a message to display the email notification. Returns the
    created notification object'''

    n = pynotify.Notification(title, message, "notification-message-im")
    if file is not None:
        n.set_property("icon-name",os.getcwd() + "/" + file)
    n.show()

    return n
</code></pre>

<p></code></p>

<p>This is what it looks like with three new messages
<a href="http://cdn.jfoucher.com/uploads/2011/01/skype-indicator.png"><img src="http://cdn.jfoucher.com/uploads/2011/01/skype-indicator.png" alt="The Ubuntu skype indicator with three new messages" title="skype-indicator" width="428" height="232" class="aligncenter size-full wp-image-253" /></a></p>

<p>The next one shows the popup notification that skype is not loaded :
<code lang="python"></p>

<pre><code>def noSkype(self):
    '''Shows a notification if skype is not started'''
    title='Start Skype'
    message='Please start skype otherwise this won\'t work'
    n = self.showNotification(title, message)
    n.set_property("icon-name",gtk.STOCK_DIALOG_WARNING)
    n.show()

    return n
</code></pre>

<p></code></p>

<p>And finally, the indicator events callbacks (what happens when we click on the skype indicator, or on a particular message</p>

<p><code lang="python"></p>

<pre><code>def display_msg(self, indicator, timestamp):
    #hide this indicator
    indicator.hide()
    #messaging menu goes back to normal
    indicator.set_property("draw-attention", "false")
    # open the skype chat window for this user
    self.skype.Client.OpenMessageDialog(indicator.get_property("handle"))
</code></pre>

<p></code></p>

<p>At the end of the file, we start everything :</p>

<p><code lang="python">
if <strong>name</strong> == "<strong>main</strong>":</p>

<pre><code>skypeind=skypeIndicator()
# Loop
gobject.timeout_add_seconds(5, skypeind.create_indicators)
gtk.main()
</code></pre>

<p></code></p>

<p>And finally, here is the complete source code :</p>

<p><code lang="python"></p>

<h1>!/usr/bin/env python</h1>

<p>#</p>

<h1>Copyright 2010 Jonathan Foucher</h1>

<p>#</p>

<h1>Authors:</h1>

<h1>Jonathan Foucher <a href="&#x6d;&#97;&#x69;&#108;&#x74;&#111;&#58;&#106;&#102;&#x6f;&#117;&#x63;&#x68;&#x65;&#x72;&#64;&#54;&#x70;&#x78;&#x2e;&#x65;&#x75;">&#x6a;&#x66;&#x6f;&#x75;&#99;&#x68;&#x65;&#x72;&#64;&#54;&#x70;&#120;&#x2e;&#101;&#117;</a></h1>

<p>#</p>

<h1>This program is free software: you can redistribute it and/or modify it</h1>

<h1>under the terms of either or both of the following licenses:</h1>

<p>#</p>

<h1>1) the GNU Lesser General Public License version 3, as published by the</h1>

<h1>Free Software Foundation; and/or</h1>

<h1>2) the GNU Lesser General Public License version 2.1, as published by</h1>

<h1>the Free Software Foundation.</h1>

<p>#</p>

<h1>This program is distributed in the hope that it will be useful, but</h1>

<h1>WITHOUT ANY WARRANTY; without even the implied warranties of</h1>

<h1>MERCHANTABILITY, SATISFACTORY QUALITY or FITNESS FOR A PARTICULAR</h1>

<h1>PURPOSE.  See the applicable version of the GNU Lesser General Public</h1>

<h1>License for more details.</h1>

<p>#</p>

<h1>You should have received a copy of both the GNU Lesser General Public</h1>

<h1>License version 3 and version 2.1 along with this program.  If not, see</h1>

<h1><a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a></h1>

<p>#</p>

<p>import indicate
import gobject
import pynotify
import gtk
import hashlib
import Skype4Py
import urllib
import os</p>

<p>class skypeIndicator:</p>

<pre><code>notifShown={}
oldcount={}
count={}
indicator={}

def __init__(self):
    #self.no_skype()
    #get skype control
    self.skype= Skype4Py.Skype()

    self.loadSkype()

    #create notification icon

    self.server = indicate.indicate_server_ref_default()
    self.server.set_type("message.im")
    self.server.set_desktop_file("/usr/share/applications/skype.desktop")
    self.server.connect("server-display", self.server_display)
    #self.server.set_status (indicate.STATUS_ACTIVE)
    self.server.show()
</code></pre>

<h1>for slot in dir(self.server):</h1>

<h1>attr = getattr(self.server, slot)</h1>

<h1>print attr</h1>

<pre><code>    #self.unread={}
    #self.indicator.set_property('draw-attention', 'true');
    self.create_indicators()
    #pass
    #indicator.connect("user-display", self.display_msg)
def loadSkype(self):
    try:
        if not self.skype.Client.IsRunning:
            self.skype.Client.Start()
    except:
        #
        print "Please open skype first"
        self.noSkype()



    try:
        self.skype.Attach()
    except Skype4Py.errors.ISkypeAPIError:
        print "Please open skype first"
        self.noSkype()
        #pass

def create_indicators(self):

    """Loads skype messages, displays them as notification bubbles and also shows them in the messaging menu"""

    #initialize count dictionaries
    self.count={}
    #get unread messages from skype, set self.unread variable
    self.get_messages()

    #self.unread is a dictionary having the username of the sender as key and a list of messages as value
    for name in self.unread:

        # Here we look at the first message from this user to set the messaging menu indicator
        # we only want one indicator per user
        msg=self.unread[name][0]

        #initialize message count for this user
        if name not in self.count:
            self.count[name]=0
        if name not in self.oldcount:
            self.oldcount[name]=0

        # if this user doesn't have his indicator yet
        if name not in self.indicator:
            # create indicator
            self.indicator[name] = indicate.Indicator()
            print "creating indicator"

            # Set indicator properties
            self.fullname=self.name_from_handle(name)
            self.indicator[name].set_property("subtype", "im")
            self.indicator[name].set_property("sender", self.fullname )
            self.indicator[name].set_property("handle", name)

            #this gets the most user-friendly name available for this user
            user=self.user_from_handle(name)

            # get an avatar for this user
            try:
                # This will only work on windows
                self.file=name + '.jpg'
                user.SaveAvatarToFile(file)
            except Skype4Py.errors.ISkypeError:
                # So on linux we use a generated monster ID. Fun but useless!
                h=hashlib.md5(name).hexdigest()
                #TODO find a way to get skype avatars on linux
                urllib.urlretrieve('http://friedcellcollective.net/monsterid/monster/%s/64' % h,name + '.jpg')
                self.file=name + '.jpg'

            #convert the imge to a pixbuf
            pixbuf=gtk.gdk.pixbuf_new_from_file(self.file)
            # for use in the indicator
            self.indicator[name].set_property_icon("icon", pixbuf)

            # set the timestamp of the indicator (this is what makes the indicator display the time since the message was received
            self.indicator[name].set_property_time("time", msg.Timestamp)

            self.indicator[name].show()
            # when the user clicks on the indicator message, open the skype messaging window for this user
            self.indicator[name].connect("user-display", self.display_msg)

        msgbody = ''
        #reverse list so latest message is at the bottom
        for eachmsg in self.unread[name][::-1]:
            # msgbody contains all the messages from that user so far
            msgbody += eachmsg.Body + "\n"

        # We set this person's indicator body to the compound text
        self.indicator[name].set_property("body", msgbody)

        # if there are more than one message from this user, we set the indicator count to be displayed in the messaging menu.
        # Otherwise the time elapsed since receiving the message will be shown
        if self.count[name] &gt; 1:
            self.indicator[name].set_property("count", str(self.count[name]))

        # If a new message arrived since last time checked, mark notification as not shown
        if self.count[name] &gt; self.oldcount[name]:
            self.notifShown[name]=False

        #If notification marked as not shown, show it
        if not self.notifShown.get(name, False) and self.showNotification(self.fullname, msgbody, self.file):
            #mark notification as shown
            self.notifShown[name]=True

            self.indicator[name].set_property("draw-attention", "true")
            self.indicator[name].show()
            print "notification shown for", name

        print "%d messages from %s" %(self.count[name],name)
    # Set oldcountt variable for next loop
    self.oldcount=self.count
    # Loop runs as long as true is returned
    return True


def name_from_handle(self,handle):
    user=self.skype.User(handle)
    if user.FullName:
        return user.FullName
    elif user.DisplayName:
        return user.DisplayName
    else:
        return handle

def user_from_handle(self,handle):
    return self.skype.User(handle)

def showNotification(self, title, message,file=None):
    '''takes a title and a message to display the email notification. Returns the
    created notification object'''

    n = pynotify.Notification(title, message, "notification-message-im")
    if file is not None:
        n.set_property("icon-name",os.getcwd() + "/" + file)
    n.show()

    return n

def noSkype(self):
    '''Shows a notification if skype is not started'''
    title='Start Skype'
    message='Please start skype otherwise this won\'t work'
    n = self.showNotification(title, message)
    n.set_property("icon-name",gtk.STOCK_DIALOG_WARNING)
    n.show()

    return n

def get_messages(self):
    print "checking messages"
    self.unread={}

    for msg in self.skype.MissedMessages:
        display_name = msg.FromHandle
        if display_name not in self.count:
            self.count[display_name]=0
        if not display_name in self.unread:
            self.unread[display_name]=[]

        self.unread[display_name].append(msg)
        self.count[display_name]+=1
    return self.unread



def server_display(self, widget, timestamp=None):
    #Show main Skype window
    self.skype.Client.Focus()

def display_msg(self, indicator, timestamp):
    #hide this indicator
    indicator.hide()
    #messaging menu goes back to normal
    indicator.set_property("draw-attention", "false")
    # open the skype chat window for this user
    self.skype.Client.OpenMessageDialog(indicator.get_property("handle"))
</code></pre>

<p>if <strong>name</strong> == "<strong>main</strong>":</p>

<pre><code>skypeind=skypeIndicator()

# Loop
gobject.timeout_add_seconds(5, skypeind.create_indicators)
gtk.main()
</code></pre>

<p></code></p>

<p>Download the script, or fork it on the <a href="https://github.com/jfoucher/ubuntu-skype-indicator">ubuntu-skype-indicator github repository</a></p>

<p>UPDATE: Before you run this script, you need to install its dependencies, python-indicate and skype4py
On ubuntu, it's as simple as running <code lang="bash">sudo apt-get install python-skype python-indicate</code></p>

                <div class="meta">
                    <!-- <span class="pdf">Download a <a href="/2011/01/14/python-skype-notifier-for-ubuntu.html.pdf" title="Download a PDF, printer-friendly copy of this article"><acronym title="Portable Document Format">PDF</acronym>, printer-friendly version of this article</a>.</span> -->
                    <span class="permalink">For referencing: <a href="/2011/01/14/python-skype-notifier-for-ubuntu.html" title="[Permalink] Python skype notifier for Ubuntu">permalink to this article</a>.</span>
                </div> <!-- /.meta -->
            </div> <!-- /.entry-content.colEight -->
            <div class="page-nav-bottom">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2011/01/12/compile-custom-kernel-on-ubuntu-10-10.html/#notebook" title="View Compile custom kernel on Ubuntu 10.10">&larr; View previous article</a></span>
				
				
				    <span class="page-nav-item floatRight"><a class="internal" rel="next"  href="/2011/01/14/spanish-characters-on-qwerty-keyboard-for-ubuntu-10-10.html/#notebook" title="View Spanish characters on Qwerty keyboard for Ubuntu 10.10">View next article &rarr;</a></span>
                
            </div> <!-- /.page-nav-bottom -->
        </div> <!-- /#notebook.center.clear -->
                <div id="footer" class="center clear">
			<ul class="nav nav-footer caps">
				<li><a href="/about.html" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html#cover" title="View the notebook entries" tabindex="0">Notebook</a></li>
				<li><a href="/#portfolio" title="Skip back up to the portfolio" tabindex="0">Portfolio</a></li>
				<li><a href="http://feeds.feedburner.com/klepas" title="Feed link" tabindex="0">Feed</a></li>
			</ul>
			<span class="backtop floatRight"><a class="internal" href="#header" title="Return to the top of this page">Back to top &uarr;</a></span>
			<div class="page-meta clear">
				<div class="info">
					<span class="index">&#9758;</span><p class="vcard"><a href="/files/Simon-Pascal-Klein.vcf" title="Download Simon Pascal Klein&rsquo;s addressbook vCard">Add me to your address book via vCard</a>.</p>
					<p class="copyright clear">Proudly bending beziers since <abbr class="date" title="2004">MMIV</abbr>&ndash;; copyright &copy; Simon Pascal Klein thereon.</p>
					<p class="licensing"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/au/" title="Content, unless specificed, licensed under a Creative Commons license">Some rights reserved</a>.</p>
					<p>For an overview of the site, see the <a href="/sitemap/" title="View the site map">site map</a> or <a href="/archives.html#cover" title="View the notebook archives">notebook archives</a>.</p>
					<h2>A playful tumble with <em>type</em>&hellip; &rarr;</h2>
					<p>&hellip;yes, <em>type</em>, not a graphic; try selecting it or resizing the page font size. Inspired by <a href="http://jontangerine.com/" title="jontangerine.com: Jon Tan&rsquo;s website">Jon Tan</a>&rsquo;s masterhead type folly, this is achieved just with some simple nested <code><span class="element">span</span></code> elements that are positioned absolutely against their relative parents, and the entire thing is sized in ems and scales nicely.</p>
				</div>
				<div class="type-folly">
					<em>Type
						<span>set
							<span>with
								<span>love
									<span>{
										<span>&hearts;
											<span>}</span>
										</span>
									</span>
								</span>
							</span>
						</span>
					</em>
					<strong>in
						<span>Georgia
							<span>&amp;
								<span>Museo</span>
							</span>
						</span>
					</strong>
					<span class="markup">&hellip;all in mostly valid <a rel="external" href="http://jigsaw.w3.org/css-validator/check/referer"><acronym title="Cascading Style Sheets">CSS</acronym></a> <span class="amp">&amp;</span> <a rel="external" href="http://validator.w3.org/check?uri=referer"><acronym title="eXtensible Hyper Text Markup Language">XHTML</acronym></a>; as <acronym title="plain old semantic (X)HTML">POSH</acronym> as can be.</span>
				</div>
			</div> <!-- /.page-meta.clear -->
		</div> <!-- /#footer.center.clear -->
	</div>
</body>
</html>