<!DOCTYPE html> 
<html lang="en">
<!--
	Access keys:
		H = homepage
		S = search input field
		L = latest article on the homepage
		A = about page
-->
<head>
    <title>
        Geeky Nuggets&thinsp;&mdash;&thinsp;Jonathan Foucher's web development experiments
        
    </title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="author" content="Jonathan Foucher" />
	<meta name="designer" content="Jonathan Foucher" />
	<meta name="developer" content="Jonathan Foucher" />
	<meta name="description" content="A blog about web development, codeigniter and wordpress, by web developer Jonathan Foucher" />
	<meta name="keywords" content="php, wordpress, codeigniter, France, Spain" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<link rel="license" href="http://creativecommons.org/licenses/by-nc-nd/2.5/en/" />
    <link href="http://tent.jfoucher.com/profile" rel="https://tent.io/rels/profile" />
    <link href='http://fonts.googleapis.com/css?family=Questrial' rel='stylesheet' type='text/css'>
	<!--<link rel="stylesheet" href="/assets/css/screen.css" type="text/css" media="screen" />-->

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>

	<script type="text/javascript" src="/assets/js/app.js"></script>
    <link rel="stylesheet" href="/assets/css/screen.css" type="text/css" media="screen" />
    <!--[if lt IE 9]>
    <script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script type="text/javascript" src="http://www.shrinktheweb.com/scripts/pagepix.js"></script>
	<link rel="alternate" href="http://feeds.feedburner.com/GeekyNuggets" title="Geeky Nuggets" type="application/atom+xml" />

	<link rel="shortcut icon" type="image/png" href="/favicon.png" />

</head>
<body>


	<div id="container" class="clearfix">
		                <header id="header" class="center">
            <div class="logo">
                <h1>
                    <a href="/" title="Return to homepage" tabindex="0" accesskey="H">
                        Geeky Nuggets
                    </a>
                </h1>
			</div>
            <div class="siteDesc"><a href="/about.html" title="About Jonathan Foucher
                &amp; contact details" tabindex="0" accesskey="A">Jonathan Foucher</a>&rsquo;s blog <span
                class="amp">&amp;</span> web development
                notebook.
            </div>
                    <nav id="nav" class="clear">
            <ul class="nav nav-header caps">
				<li><a href="/about.html" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
				<li><a href="/archives.html" title="View the blog archives" tabindex="0">Archives</a></li>

				<li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Subscribe to my posts, by email or in your feed reader" tabindex="0">Feed</a></li>
            </ul>
			<div class="sitesearch">

                <!-- Google Custom Search Element -->
                <!-- <form action="http://www.google.com/cse" class="center_column" id="searchForm" >
                    <fieldset>
                       <input type="hidden" name="cx" value="004905032692135561336:flcwnz7i1ww" />
                       <input type="hidden" name="ie" value="UTF-8" />
                       <label for="search" class="hidden">Search</label>
                       <input id="search" class="text-input" type="text" name="q" size="15" tabindex="0" accesskey="S" />
                       <input id="searchsubmit" type="submit" name="sa" value="Search" tabindex="0" />
                    </fieldset>
                </form>-->

            </div>

        </nav> <!-- /#nav.clear -->




		</header> <!-- /#header.center -->

        
		<div id="notebook" class="center clear">
			<div class="page-nav-top">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2013/05/building-and-using-minimalist-running-shoes.html" title="Read How I built running shoes for my whole family in one sunday afternoon (Huarache sandals)">&larr; Read previous article</a></span>
				
				
            </div> <!-- /.page-nav-top -->

            <h2 class="post-title">
                <a href="/2016/12/webGL-webworkers-boat-calculations.html" title="Permanent link to Building a webGL and webworkers boat hydrostatics app">
                    Building a webGL and webworkers boat hydrostatics app
                </a>
            </h2>
            <div class="meta">
                <!-- <span class="pdf">Download a <a href="/2016/12/webGL-webworkers-boat-calculations.html.pdf" title="Download a PDF, printer-friendly copy of this article"><acronym title="Portable Document Format">PDF</acronym>, printer-friendly version of this article</a>.</span> -->
                <div class="hero">

                    <p>
                        I had a need for a simple program to do some calculations for a boat design I'm studying, so I built it from scratch with webGL and webworkers
                        <br /><small>by <a href="https://plus.google.com/+JonathanFoucher?rel=author">Jonathan Foucher</a></small>
                    </p>
                </div>
                <span class="permalink">For referencing: <a href="/2016/12/webGL-webworkers-boat-calculations.html" title="[Permalink] Building a webGL and webworkers boat hydrostatics app">permalink to this article</a>.</span>
                <span class="date" title="2016-12-20 09:17:07 +0100">
                    <span class="published">Published&thinsp;&bull;</span>
                    <span class="day">20</span>
                    <span class="month"><abbr>Dec</abbr></span>
                    <span class="year">2016</span>
                </span>
            </div> <!-- /.meta -->
            <div id="entry-content">

                <p>I've recently felt the urge to start designing boats again, as I have had some ideas I wanted to explore, specifically for boats of the <a href="http://classemini.org">Mini 650 class</a>. The software I use has basic hydrostatics capabilities, but only for an upright boat. It cannot calculate the GZ curve, or get the righting moment at specific heel angles, which is a crucial data for the kind of craft I wanted to design.</p>

<p>Existing solutions are extremely powerful and extremely expensive, so I decided i'd spend a few days rolling my own, with only the features I needed for the time being. I have all the technical background for this type of calculations, so I figured it shouldn't be too hard. I really wanted to display a 3D view of the model, and not have it only output data in table format, and since I had never used web GL and was curious about, I figured it was the perfect time to try it out. Pro tip : if you're not used to openGL or working in 3D programatically, use <a href="https://threejs.org/">three.js</a>. Thank me later.</p>

<p>So at first I built something very basic that just displayed the model in threejs and did some static calculations, in the UI thread. At first it worked ok, but as soon as I added functionality to solve for trim (to align longitudinal center of gravity with the longitudinal center of buoyancy) it started to get very slow. The 3D view could not even be moved around anymore because the UI thread was doing all the calculations in the foreground. Basically to do this kind of calculations, you have to move the model up and down to adjust for the correct displacement, and then pitch it forwards or aft until the center of buoyancy aligns with the center of gravity. This loop is computationally intensive and made everything grind to a halt.</p>

<p>So webworkers to the rescue. I had never really used them either, but they promised to make it easy to send most of the work to a background thread that would not slow down my UI. I refactored my code to put all the heavy lifting into separate files that could then be called as a web worker. I also had to add messaging to pass data to and from the UI javascript. That was fairly easy to do, as they are simple calls to postMessage, and a callback function in the UI and the worker to receive sent messages. Very easy and obvious, so great !</p>

<p>The calculations are accurate, I've had them checked in many cases against an old Hydromax version, which is an established solution in the field, and the results match within about a percentage point. The only difficulty I'm still struggling with is to properly draw the underwater stations and the waterline, but this is only a display bug and does not affect the results. What happens is that there are many edge cases that have to be accounted for, depending on the type and quality of the input file. I'm still working on that.</p>

<p>If you like designing boats and currently do these kinds of calculations by hand or in a spreadsheet, or if your current software does not solve for trim, you will definitely want to <a href="https://hydro.marinetechs.com/?utm_source=jfoucher&amp;utm_campaign=launch&amp;utm_medium=blog">give this tool a try</a></p>

<p>If you do, and you like it, or you hate it, or it doesn't work, or anything, your feedback would be invaluable. Contact me <a href="mailto:j_foucher@marinetechs.com">by email</a> or through <a href="http://jfoucher.com/about.html#contactForm">this blog's contact form</a>.</p>


            </div> <!-- /.entry-content.colEight -->
            <div class="page-nav-bottom">
                
				    <span class="page-nav-item floatLeft"><a class="internal" rel="prev"  href="/2013/05/building-and-using-minimalist-running-shoes.html" title="Read How I built running shoes for my whole family in one sunday afternoon (Huarache sandals)">&larr; View previous article</a></span>
				
				
            </div> <!-- /.page-nav-bottom -->
        </div> <!-- /#notebook.center.clear -->
        

            <footer id="footer" class="clear">
        <span class="backtop"><a class="internal" href="#header" title="Return to the top of this page">Back to top &uarr;</a></span>
        <nav>
            <ul id="nav-footer">
                <li><a href="/about.html" title="About &amp; contact information" tabindex="0">About <span class="amp">&amp;</span> Contact</a></li>
                <li><a href="/archives.html" title="View the blog archives" tabindex="0">Archives</a></li>

                <li><a href="http://feeds.feedburner.com/GeekyNuggets" title="Feed link" tabindex="0">Feed</a></li>
            </ul>
        </nav>

        <div class="page-meta clear">
            <div class="info">

                <p class="copyright ">
                    This blog has been online in one form or another since
                    <span class="date" title="March 2004">2004</span><br />Copyright &copy; <a href="http://jfoucher.com">Jonathan
                    Foucher.</a><br /><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"
                       title="You can use this for non-comercial purposes, provided you cite me as the author, and do not modify the content">
                        Creative Commons License
                    </a>
                    <br />
                    <a href="/jfoucher-6px.eu.asc">GPG Key</a>
                </p>
            </div>

        </div> <!-- /.page-meta.clear -->
    </footer> <!-- /#footer.center.clear -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8465441-2']);
    _gaq.push(['_trackPageview']);



    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +
        '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();


    var docHeight = document.height,
    vscroll = $(document).scrollTop();

    $(document).bind('scroll', function(){
        var docHeight = document.height,
                vscroll = $(document).scrollTop();

        if(vscroll > docHeight / 2) {
            $(document).unbind('scroll');
            _gaq.push(['_trackEvent', 'scrolled_half', 'read']);
            console.log('not a bounce')
        }
    });

    </script>

    <script type="text/javascript">
        var clicky_site_ids = clicky_site_ids || [];
        clicky_site_ids.push(100617617);
        (function() {
            var s = document.createElement('script');
            s.type = 'text/javascript';
            s.async = true;
            s.src = '//static.getclicky.com/js';
            ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
        })();
    </script>
    <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100617617ns.gif" /></p></noscript>
</body>
</html>
	</div>
